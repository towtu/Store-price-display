<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chiekoi Admin</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; background-color: #f4f4f9; }
        .card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; box-sizing: border-box; border: 1px solid #ccc; border-radius: 6px; }
        button { width: 100%; padding: 12px; margin-top: 10px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-green { background: #2e7d32; color: white; }
        .btn-blue { background: #1976d2; color: white; }
        .btn-edit { background: #ff9800; color: white; width: auto; padding: 8px 15px; border-radius: 4px; }
        
        .list-item { border-bottom: 1px solid #eee; padding: 12px 0; display: flex; justify-content: space-between; align-items: center; }
        .list-info { flex-grow: 1; }
        .search-admin { margin-bottom: 15px; border: 2px solid #1976d2; }

        #debug-log { background: #333; color: #0f0; padding: 10px; font-family: monospace; font-size: 12px; margin-top: 20px; border-radius: 5px; }
    </style>
</head>
<body>

    <div id="login-card" class="card">
        <h3>üîê Chiekoi Admin Login</h3>
        <input type="email" id="email" placeholder="Enter your email">
        <input type="password" id="password" placeholder="Enter your password">
        <button class="btn-blue" onclick="tryLogin()">Login</button>
    </div>

    <div id="admin-panel" class="card" style="display:none;">
        <h3>‚úÖ Manage Products</h3>
        
        <input type="hidden" id="productId">
        
        <label>Category:</label>
        <select id="p-cat">
            <option value="Candies">Candies / Chocolates</option> 
            <option value="Beverages">Beverages</option>
            <option value="Powdered Drinks">Powdered Drinks</option>
            <option value="Canned Goods">Canned Goods</option>
            <option value="Instant Packed Noodles">Instant Packed Noodles</option>
            
            <option value="Chips">Chips</option>
            <option value="Packaged Snacks">Packaged Snacks</option>
            <option value="Small Chicherya">Small Chicherya</option>
            <option value="Cooking">Cooking Necessities</option>
            <option value="Clothes Soap">Clothes Soap</option>
            <option value="Hygiene">Hygiene</option>
            <option value="Medicine">Medicine</option>
            <option value="Others">Others</option>
        </select>

        <input type="text" id="p-name" placeholder="Product Name (e.g. Maxx)">
        <input type="text" id="p-unit" placeholder="Quantity Note (e.g. 4 pcs, or 1 pack)">
        <input type="number" id="p-price" placeholder="Price (e.g. 5)">
        
        <button class="btn-green" onclick="saveProduct()">Save / Update</button>
        
        <hr style="margin: 20px 0;">
        <h4>üì¶ Current Inventory</h4>
        
        <input type="text" id="admin-search" class="search-admin" placeholder="üîç Search inventory..." onkeyup="filterAdminList()">

        <div id="product-list">Loading...</div>
    </div>

    <div id="debug-log">System Status: Waiting...</div>

    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.0/firebase-auth-compat.js"></script>
    
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyBzigjOzW9bnctbWByO4Q69qvJdPY7HoJE",
            authDomain: "chiekoy-store.firebaseapp.com",
            databaseURL: "https://chiekoy-store-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "chiekoy-store",
            storageBucket: "chiekoy-store.firebasestorage.app",
            messagingSenderId: "1071245303408",
            appId: "1:1071245303408:web:1ff9b43b6f41192c079eb5",
            measurementId: "G-ZMBDDEGE6N"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        let allAdminProducts = []; // To store fetched products for filtering

        function tryLogin() {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            auth.signInWithEmailAndPassword(e, p).catch(err => alert(err.message));
        }

        auth.onAuthStateChanged((user) => {
            if (user) {
                document.getElementById('login-card').style.display = 'none';
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('debug-log').innerText = "System Status: Logged in successfully.";
                loadProducts();
            }
        });

        function saveProduct() {
            const id = document.getElementById('productId').value;
            const cat = document.getElementById('p-cat').value;
            const n = document.getElementById('p-name').value;
            const u = document.getElementById('p-unit').value;
            const p = document.getElementById('p-price').value;
            
            if(!n || !p) return alert("Fill Name and Price");

            const data = { c: cat, n: n, u: u, p: parseFloat(p) };
            
            if(id) {
                db.ref('products/' + id).update(data).then(() => { alert("Updated!"); clearForm(); });
            } else {
                db.ref('products').push(data).then(() => { alert("Added!"); clearForm(); });
            }
        }

        function loadProducts() {
            db.ref('products').on('value', (snap) => {
                allAdminProducts = [];
                snap.forEach(child => {
                    allAdminProducts.push({
                        id: child.key,
                        ...child.val()
                    });
                });
                renderAdminList(allAdminProducts);
            });
        }

        function renderAdminList(items) {
            const list = document.getElementById('product-list');
            list.innerHTML = "";
            
            if (items.length === 0) {
                list.innerHTML = "<p style='color:#888;'>No items found.</p>";
                return;
            }

            items.forEach(data => {
                const category = data.c || "Others";
                const unit = data.u ? `(${data.u})` : ""; 
                
                list.innerHTML += `
                    <div class="list-item">
                        <div class="list-info">
                            <small style="color:#888; font-weight:bold;">${category.toUpperCase()}</small><br>
                            <b>${data.n}</b> <small style="color:#666;">${unit}</small><br>
                            <span style="color:#2e7d32; font-weight:bold;">‚Ç±${data.p}</span>
                        </div>
                        <button class="btn-edit" onclick="edit('${data.id}','${data.n}','${data.p}', '${category}', '${data.u || ''}')">Edit</button>
                    </div>`;
            });
        }

        // Search logic for Admin Panel
        function filterAdminList() {
            const query = document.getElementById('admin-search').value.toLowerCase();
            const filtered = allAdminProducts.filter(item => 
                (item.n && item.n.toLowerCase().includes(query)) || 
                (item.c && item.c.toLowerCase().includes(query))
            );
            renderAdminList(filtered);
        }

        function edit(id, n, p, c, u) {
            document.getElementById('productId').value = id;
            document.getElementById('p-name').value = n;
            document.getElementById('p-price').value = p;
            document.getElementById('p-cat').value = c;
            document.getElementById('p-unit').value = u; 
            window.scrollTo(0,0);
        }

        function clearForm() {
            document.getElementById('productId').value = "";
            document.getElementById('p-name').value = "";
            document.getElementById('p-unit').value = "";
            document.getElementById('p-price').value = "";
            // Keep the category as the last selected one to make bulk-adding easier
        }
    </script>
</body>
</html>